{% macro render_emoji_picker(message_id) %}
<div class="emoji-picker">
    <button type="button" class="emoji-picker-toggle" data-toggle="emoji-picker">
        <i class="far fa-smile"></i>
    </button>
    <div class="emoji-picker-popup" style="display: none;">
        <div class="emoji-list">
            <button type="button" class="emoji-btn" data-emoji="👍" data-message-id="{{ message_id }}">👍</button>
            <button type="button" class="emoji-btn" data-emoji="❤️" data-message-id="{{ message_id }}">❤️</button>
            <button type="button" class="emoji-btn" data-emoji="😊" data-message-id="{{ message_id }}">😊</button>
            <button type="button" class="emoji-btn" data-emoji="😂" data-message-id="{{ message_id }}">😂</button>
            <button type="button" class="emoji-btn" data-emoji="😮" data-message-id="{{ message_id }}">😮</button>
            <button type="button" class="emoji-btn" data-emoji="😢" data-message-id="{{ message_id }}">😢</button>
            <button type="button" class="emoji-btn" data-emoji="👏" data-message-id="{{ message_id }}">👏</button>
            <button type="button" class="emoji-btn" data-emoji="🎉" data-message-id="{{ message_id }}">🎉</button>
        </div>
    </div>
</div>
{% endmacro %}

{% macro render_reactions(reactions) %}
<div class="message-reactions">
    {% set grouped_reactions = {} %}
    {% for reaction in reactions %}
        {% if reaction.emoji not in grouped_reactions %}
            {% set _ = grouped_reactions.update({reaction.emoji: [reaction]}) %}
        {% else %}
            {% set _ = grouped_reactions[reaction.emoji].append(reaction) %}
        {% endif %}
    {% endfor %}
    
    {% for emoji, reactions_list in grouped_reactions.items() %}
    <div class="reaction-badge" 
         title="{{ reactions_list|map(attribute='user.name')|join(', ') }}"
         data-emoji="{{ emoji }}">
        {{ emoji }} {{ reactions_list|length }}
    </div>
    {% endfor %}
</div>
{% endmacro %}